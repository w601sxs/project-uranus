version: '3'

services:
  kbos:
    build: .
    entrypoint: python /code/engine_main.py
    volumes:
      - ../data:/data:Z
    env_file:
      - ./envs/directories.env
      - ./envs/engine.env
    environment: 
      - FLAG_COND=kbos
  klax:
    build: .
    entrypoint: python /code/engine_main.py
    volumes:
      - ../data:/data:Z
    env_file:
      - ./envs/directories.env
      - ./envs/engine.env
    environment: 
      - FLAG_COND=klax
  db_updator:
    build: .
    entrypoint: python /code/database_updator.py
    volumes:
      - ../data:/data:Z
    env_file:
      - ./envs/directories.env
    environment: 
      - RERUN=120
    # depends_on: 
    #   - db
    restart: always
  audio_converter:
      build: .
      entrypoint: python /code/audio_converter.py
      volumes:
        - ../data:/data:Z
      environment: 
        - ./envs/directories.env
        - ./envs/audio_converter.env
      restart: always
  # db:
  #   image: mysql:5.7
  #   container_name: mysql
  #   volumes:
  #     - ../data/db/:/var/lib/mysql
  #   restart: always
  #   env_file:
  #     - ./envs/directories.env
  #     - ./envs/db.env
  #   ports:
  #     - "33061:3306"
