version: '3'

# used in AWS deployment
x-aws-vpc: ${AWS_VPC}
x-aws-cluster: ${AWS_ECS_CLUSTER}

services:
  kbos:
    build: .
    image: kbos_listeners
    entrypoint: python /code/engine_main.py
    volumes:
      - enginedata:/data:Z
    env_file:
      - ./envs/directories.env
      - ./envs/engine.env
    environment: 
      - FLAG_COND=kbos
  klax:
    build: .
    image: klax_listeners
    entrypoint: python /code/engine_main.py
    volumes:
      - enginedata:/data:Z
    env_file:
      - ./envs/directories.env
      - ./envs/engine.env
    environment: 
      - FLAG_COND=klax
  db_updator:
    build: .
    image: db_updator
    entrypoint: python /code/database_updator.py
    volumes:
      - enginedata:/data:Z
    env_file:
      - ./envs/directories.env
    environment: 
      - RERUN=120
    restart: always
  audio_converter:
    build: .
    image: audio_converter
    entrypoint: python /code/audio_converter.py
    volumes:
      - enginedata:/data:Z
    env_file: 
      - ./envs/directories.env
    environment: 
      - RERUN=30
    restart: always

volumes:
  enginedata: