# used in AWS deployment
x-aws-cluster: ${AWS_ECS_CLUSTER}

services:
  audio_fetcher:
    build: .
    image: ${IMAGE_URI:-klax_listeners}:${IMAGE_TAG:-latest}
    entrypoint: python /code/engine_main.py
    volumes:
      - enginedata:/data:Z
    env_file:
      - ./envs/directories.env
      - ./envs/engine.env
    environment: 
      - FLAG_COND=klax,kbos
  audio_converter:
    build: .
    image: ${IMAGE_URI:-audio-converter}:${IMAGE_TAG:-latest}
    entrypoint: python /code/audio_converter.py
    volumes:
      - enginedata:/data:Z
    env_file: 
      - ./envs/directories.env
    environment: 
      - RERUN=30
    restart: always

volumes:
  enginedata: